#!/command/with-contenv bashio

if bashio::config.true "enable_live" && bashio::config.has_value "live_uuid"; then
    bashio::log.info "Telldus Live enabled."
    sleep "$(bashio::config 'live_delay')"
    bashio::log.info "UUID has been entered in config options. Starting Telldus Live..."
    exec tellive_core_connector /etc/tellive.conf
fi

# Check if live is enabled but UUID is not yet configured (registration phase)
if bashio::config.true "enable_live" && bashio::config.is_empty "live_uuid"; then
    bashio::log.info "Telldus Live: Waiting for registration to complete via runonce service."
    bashio::log.info "The tellivecore service will remain disabled until live_uuid is configured."
else
    bashio::log.info "Telldus Live is not enabled. Service disabled."
fi

exec s6-svc -Od .
